<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
  <meta name="author" content="Zack Sargent">
  <meta property="article:author" content="Zack Sargent">
  <meta name="keywords" content="nkcyber, cybersecurity, python">
  <title> How to host Square CTF for practice </title>
  <meta name="twitter:title" content="How to host Square CTF for practice">
  <meta name="twitter:text:title" content="How to host Square CTF for practice">
  <meta name="twitter:description" content="How to host Square CTF for practice">
  <meta name="description" content="How to host Square CTF for practice">
  <meta name="og:description" content="How to host Square CTF for practice">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://zack.fyi/blog/square-ctf-2022.html">
  <link rel="canonical" href="https://zack.fyi/blog/square-ctf-2022.html">
  <meta property="article:published_time" content="2023-11-08T00:00:00+00:00">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="/assets/common.css" > 
  <link rel="stylesheet" type="text/css" href="/assets/code.css" > 
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
</head>

<body>
  <header>
    <nav id="top-nav">
        <div class="logo">
            <a href="/">
                Zack Sargent
            </a>
        </div>
        <div class="links">
            <a href="/blog/index.html">Blog</a>
            <a href="/contact.html">Contact</a>
        </div>
    </nav>
</header>

  <main>
    <article class="post">
      <h1 class="post-title"> How to host Square CTF for practice</h1>
      <div id="post-meta">
        <span id="date-published">
          <i class="fa fa-calendar" aria-hidden="true"></i>
          <time datetime="2023-11-08" pubdate="pubdate">Wednesday, November  8, 2023</time>
        </span>
        <span id="reading-time">
          <i class="fa fa-clock-o" aria-hidden="true"></i> 
          30 mins
        </span>
        <span class="tags">
          <a href="/tag/nkcyber.html" class="tag">nkcyber</a> <a href="/tag/cybersecurity.html" class="tag">cybersecurity</a> <a href="/tag/python.html" class="tag">python</a>
        </span>
      </div>

    
<details id="table-of-contents" class="toc" role="doc-toc">
<summary id="table-of-contents-header"> Table of Contents </summary>

<ul>
<li><a href="#the-challenges-were-going-to-host">The challenges we‚Äôre going to host:</a></li>
<li><a href="#getting-the-zip-files">Getting the zip files</a></li>
<li><a href="#using-docker">Using Docker?</a>
<ul>
<li><a href="#nojs-modifications">nojs modifications</a></li>
</ul></li>
<li><a href="#deployment-fights-back">Deployment fights back</a>
<ul>
<li><a href="#fixing-nojs">Fixing nojs</a></li>
</ul></li>
<li><a href="#are-challenges-from-2021-easy-to-host">Are challenges from 2021 easy to host?</a>
<ul>
<li><a href="#hugeprimes">HugePrimes</a></li>
</ul></li>
<li><a href="#inv-characters">inv-characters</a></li>
<li><a href="#our-status-so-far">Our status so far:</a></li>
<li><a href="#a-new-hope">A new hope</a></li>
<li><a href="#resource-limiations-part-2">Resource limiations, part 2</a></li>
<li><a href="#back-to-ez-pwn-1">Back to ez-pwn-1</a></li>
<li><a href="#allow-all-solutions-on-the-firewall">Allow all solutions on the firewall</a></li>
<li><a href="#ctfd-resources">CTFd resources</a></li>
</ul>

</details>

<p>Next Friday (Nov 17, 2023) is the <a href="https://2023.squarectf.com/">2023 Square CTF</a>, and I‚Äôve decided that <a href="https://www.nku.edu/academics/informatics/beyond/student-organizations/nkcyber.html">my school‚Äôs cybersecurity club</a> is going to participate. In an effort to prepare, we‚Äôre going to work through a selection of the <a href="https://squarectf.com/2022/index.html">2022 challenges</a>.</p>
<p>I want to sincerely say thank you to all of <a href="https://squarectf.com/#:~:text=Credits">the Square CTF contributors</a> for hosting such a great event. üôè</p>
<aside>
<strong>Warning:</strong> This is a stream-of-consciousness work log, for use as future reference, mostly written while waiting for Docker images to build on underpowered hardware.
</aside>
<h2 id="the-challenges-were-going-to-host">The challenges we‚Äôre going to host:</h2>
<p>Spoiler! I wasn‚Äôt able to get all of the challenges to host easily. I‚Äôve specifically chosen:</p>
<ul>
<li><a href="https://squarectf.com/2022/ezpwn1.html">EZ pwn 1</a></li>
<li><a href="https://squarectf.com/2022/ezpwn2.html">EZ pwn 2</a></li>
<li><a href="https://squarectf.com/2022/developershubris.html">Developer‚Äôs Hubris</a></li>
<li><a href="https://squarectf.com/2021/hugeprimes.html">Huge Primes</a></li>
<li><a href="https://squarectf.com/2021/koreanspaceprogram.html">Korean Space Program</a> A.K.A. Inv-characters</li>
</ul>
<p>It‚Äôs very possible that I‚Äôm missing something obvious, and that I shouldn‚Äôt‚Äôve had the errors I did. I‚Äôm still putting this document out there, just for future reference.</p>
<p>Future club members may find these modified challenges zipped in <u>NKCyber Documents/CST/Meeting Resources/2023-11-10</u>.</p>
<hr />
<h2 id="getting-the-zip-files">Getting the zip files</h2>
<p>Square has generously provided archives of past challenges as zip files:</p>
<pre><code>https://squarectf.com/2022/data/ezpwn1.zip
https://squarectf.com/2022/data/ezpwn2.zip
https://squarectf.com/2022/data/ezre1.zip
https://squarectf.com/2022/data/emojihunt.zip
https://squarectf.com/2022/data/squarepaymentterminal.zip
https://squarectf.com/2022/data/hardcopy.zip
https://squarectf.com/2022/data/roplikeeasy.zip
https://squarectf.com/2022/data/roplikemedium.zip
https://squarectf.com/2022/data/roplikehard.zip
https://squarectf.com/2022/data/threeitemmenu.zip
https://squarectf.com/2022/data/itsrightthere.zip
https://squarectf.com/2022/data/yetanotherreversingactivity.zip
https://squarectf.com/2022/data/alexhanlonhastheflag.zip
https://squarectf.com/2022/data/xark.zip
https://squarectf.com/2022/data/goinginblind.zip
https://squarectf.com/2022/data/nojs.zip
https://squarectf.com/2022/data/developershubris.zip
https://squarectf.com/2022/data/blockchain.zip</code></pre>
<aside>
<p>This list was obtained by running:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(<span class="bu">document</span><span class="op">.</span><span class="fu">getElementsByClassName</span>(<span class="st">&#39;text-muted&#39;</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>     <span class="op">.</span><span class="fu">map</span>(e <span class="kw">=&gt;</span> e<span class="op">.</span><span class="at">firstChild</span>)<span class="op">.</span><span class="fu">filter</span>(e <span class="kw">=&gt;</span> e<span class="op">.</span><span class="at">href</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>     <span class="op">.</span><span class="fu">map</span>(e<span class="kw">=&gt;</span>e<span class="op">.</span><span class="at">href</span><span class="op">.</span><span class="fu">replace</span>(<span class="st">&#39;.html&#39;</span><span class="op">,</span> <span class="st">&#39;.zip&#39;</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>     <span class="op">.</span><span class="fu">join</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>))</span></code></pre></div>
on <a href="https://squarectf.com/2022/index.html" class="uri">https://squarectf.com/2022/index.html</a>, and filtering out the Pulse Check and changing <code>3itemmenu</code> to <code>threeitemmenu</code>, and then adding <code>/data</code> after <code>2022</code>.
</aside>
<p>We can download all of the zip files and extract them with this script:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>square_zips <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/ezpwn1.zip</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/ezpwn2.zip</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/ezre1.zip</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/emojihunt.zip</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/squarepaymentterminal.zip</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/hardcopy.zip</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/roplikeeasy.zip</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/roplikemedium.zip</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/roplikehard.zip</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/threeitemmenu.zip</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/itsrightthere.zip</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/yetanotherreversingactivity.zip</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/alexhanlonhastheflag.zip</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/xark.zip</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/goinginblind.zip</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/nojs.zip</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/developershubris.zip</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2022/data/blockchain.zip</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span>.strip().split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>prefix <span class="op">=</span> <span class="st">&#39;https://squarectf.com/2022/&#39;</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>zip_dir <span class="op">=</span> <span class="st">&#39;./zips&#39;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>unzip_dir <span class="op">=</span> <span class="st">&#39;./unzips&#39;</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>Path(zip_dir).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>) <span class="co"># make directory if it doesn&#39;t exist</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>Path(unzip_dir).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download(url):</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    os.system(<span class="ss">f&#39;wget --directory-prefix &quot;</span><span class="sc">{</span>zip_dir<span class="sc">}</span><span class="ss">&quot; </span><span class="sc">{</span>url<span class="sc">}</span><span class="ss">&#39;</span>) <span class="co"># string interpolation into shell commands is dangerous, fyi.</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> url <span class="kw">in</span> square_zips: <span class="co"># download all zip files</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    download(url)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(zip_dir): <span class="co"># unzip all zip files</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    downloaded_file <span class="op">=</span> os.path.join(zip_dir, <span class="bu">file</span>)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> zipfile.ZipFile(downloaded_file, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> zip_ref:</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        zip_ref.extractall(unzip_dir)</span></code></pre></div>
<h2 id="using-docker">Using Docker?</h2>
<p>Of these, it‚Äôs important to note that not every directory comes with a Dockerfile. We can check this with Python:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(unzip_dir): <span class="co"># unzip all zip files</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    target <span class="op">=</span> os.path.join(unzip_dir, <span class="bu">file</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    has_dockerfile <span class="op">=</span> <span class="bu">len</span>(<span class="bu">list</span>(Path(target).glob(<span class="st">&#39;**/Dockerfile&#39;</span>))) <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    dockerfile_status <span class="op">=</span> <span class="st">&#39;‚úÖ&#39;</span> <span class="cf">if</span> has_dockerfile <span class="cf">else</span> <span class="st">&#39;‚ùå&#39;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(dockerfile_status, <span class="bu">file</span>)</span></code></pre></div>
<pre><code>‚úÖ ez-pwn-1
‚úÖ ez-pwn-2
‚ùå ez-re-1
‚ùå emoji_hunt
‚ùå sqUARe_paymenT_terminal_pt1
‚ùå hard-copy
‚úÖ ROPlike-easy
‚úÖ ROPlike-medium
‚úÖ ROPlike-hard
‚úÖ three_item_menu
‚ùå its-right-there
‚ùå yet-another-reversing-activity
‚úÖ AlexHanlonHasTheFlag
‚úÖ xark
‚úÖ GoingInBlind
‚úÖ nojs
‚úÖ DevelopersHubris
‚ùå BLOCKchain</code></pre>
<p>Given that my club is only going to have a few hours to work through the problems, I‚Äôve chosen to not worry about hosting the challenges that don‚Äôt come with Docker containers.</p>
<p>So, what happens if we host one of these Dockerfiles?</p>
<p>Let‚Äôs start with <code>ez-pwn-1</code> as an example.</p>
<p>There are a couple files:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> file <span class="pp">*</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">dist:</span>                directory</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Dockerfile:</span>          ASCII text</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ez-pwn-1:</span>            ELF 64-bit LSB pie executable, x86-64, version 1 <span class="er">(</span><span class="ex">SYSV</span><span class="kw">)</span><span class="ex">,</span> dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=26217945613bd2e86e73d01ae50a82c592549ccc, not stripped</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ez-pwn-1.c:</span>          C source, ASCII text</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ex">README.md:</span>           HTML document, ASCII text, with very long lines <span class="er">(</span><span class="ex">460</span><span class="kw">)</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ex">run.sh:</span>              Bourne-Again shell script, ASCII text executable</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="ex">the_flag_is_in_here:</span> directory</span></code></pre></div>
<p>And if we are in the directory, we can build it with:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker build <span class="at">-t</span> ez-pwn-1 . </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">--rm</span> <span class="at">-d</span> <span class="at">-p</span> 8001:8000 ez-pwn-1</span></code></pre></div>
<p>Visiting the url hosted by the Docker container returns <code>ERR_INVALID_HTTP_RESPONSE</code>, and populates the logs with:</p>
<pre><code>: not found.1
sh: 2: Host:: not found</code></pre>
<p>I don‚Äôt know why this is.</p>
<p>We can try again with <code>ez-pwn-2</code>. Let‚Äôs use the <code>run.sh</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build . <span class="at">-t</span> ez-pwn-2</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="at">-p</span> <span class="va">${HOST_PORT}</span>:8000 ez-pwn-2</span></code></pre></div>
<p>So, we can use:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> export HOST_PORT=8001</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> chmod +x run.sh</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./run.sh</span></code></pre></div>
<p>This has the same issue, and returns:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-v</span> 127.0.0.1:8001</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span>   Trying 127.0.0.1:8001...</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Connected to 127.0.0.1 <span class="er">(</span><span class="ex">127.0.0.1</span><span class="kw">)</span> <span class="ex">port</span> 8001 <span class="er">(</span><span class="co">#0)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> GET <span class="ex">/</span> HTTP/1.1</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> Host: <span class="ex">127.0.0.1:8001</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> User-Agent: <span class="ex">curl/7.85.0</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> Accept: <span class="ex">*/*</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Received HTTP/0.9 when not allowed</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> Closing connection 0</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="ex">curl:</span> <span class="er">(</span><span class="ex">1</span><span class="kw">)</span> <span class="ex">Received</span> HTTP/0.9 when not allowed</span></code></pre></div>
<p>Let‚Äôs check how many actually host a web interface with Docker:</p>
<pre><code>‚ùå ez-pwn-1
‚ùå ez-pwn-2
‚ùå ROPlike-easy
‚ùå ROPlike-medium
‚ùå ROPlike-hard
‚ùå three_item_menu
‚úÖ AlexHanlonHasTheFlag - works with docker compose up
‚úÖ xark - works with docker compose up
‚úÖ GoingInBlind - works with docker compose up
‚úÖ nojs - works after modifying Dockerfile (see below)
‚úÖ DevelopersHubris - worked first try, ironically</code></pre>
<h3 id="nojs-modifications">nojs modifications</h3>
<p><code>nojs</code> errored out in the Dockerfile on line <code>ADD keys/deploy_id_rsa /root/.ssh/id_rsa</code>, but after commenting out the lines 5-8, it then errored out on installing <code>openjdk-11-jre</code>. I removed the requirement for <code>openjdk-11-jre</code>, and it worked perfectly. I‚Äôm not sure why these were required, but everything seems to work fine without them. I ran with <code>./run.sh</code> with no errors. <strong>Spoiler: it would not <em>always</em> work without errors.</strong></p>
<aside>
At this point I must mention it‚Äôs very possible I‚Äôm doing something blatantly wrong here. I‚Äôm not sure why so many Docker images are failing to work. However, given that we aren‚Äôt going to have time to get through many challenges, I only need a couple to work.
</aside>
<p>Great! We now have the 5 challenges we‚Äôre going to do this Friday.</p>
<p>We can move them into a separate directory with:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil                                                                                     </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>approved <span class="op">=</span> (<span class="st">&#39;AlexHanlonHasTheFlag&#39;</span>, <span class="st">&#39;xark&#39;</span>, <span class="st">&#39;GoingInBlind&#39;</span>, <span class="st">&#39;nojs&#39;</span>, <span class="st">&#39;DevelopersHubris&#39;</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>approved_dir <span class="op">=</span> <span class="st">&#39;./approved&#39;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>Path(approved_dir).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>) <span class="co"># make directory if it doesn&#39;t exist</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> folder <span class="kw">in</span> approved:</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    source <span class="op">=</span> os.path.join(unzip_dir, folder)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    destination <span class="op">=</span> os.path.join(approved_dir, folder)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    shutil.move(source, destination)</span></code></pre></div>
<p>So, we get the list:</p>
<pre><code>approved/
‚îú‚îÄ‚îÄ AlexHanlonHasTheFlag
‚îú‚îÄ‚îÄ DevelopersHubris
‚îú‚îÄ‚îÄ GoingInBlind
‚îú‚îÄ‚îÄ nojs
‚îî‚îÄ‚îÄ xark</code></pre>
<p>All of these have a <code>run.sh</code> except for <code>xark</code>.</p>
<p>So, we can add a <code>run.sh</code> to the <code>xark</code> folder:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> pwd</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">approved/xark</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cat <span class="op">&gt;</span> run.sh <span class="op">&lt;&lt; &#39;EOF&#39;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="st">#!/bin/bash</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="st">docker compose up -d</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> chmod +x run.sh</span></code></pre></div>
<h2 id="deployment-fights-back">Deployment fights back</h2>
<p>From there, I copied the file to a <a href="https://www.digitalocean.com/products/droplets">Digital Ocean Droplet</a> to host for this Friday.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> <span class="at">-r</span> Square2022Approved.zip root@ctfd.zack.fyi:/root/square_ctf</span></code></pre></div>
<p>(Where <code>Square2022Approved.zip</code> contains all of the modifications described above)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span> Square2022Approved.zip</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> host.py</span></code></pre></div>
<p>On the Digital Ocean Droplet, I then wrote the script:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>host_ports <span class="op">=</span> {</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;AlexHanlonHasTheFlag&quot;</span>: <span class="dv">8001</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;GoingInBlind&quot;</span>: <span class="dv">8002</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;DevelopersHubris&quot;</span>: <span class="dv">8003</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;nojs&quot;</span>: <span class="dv">8004</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;xark&quot;</span>: <span class="dv">8005</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> folder, port <span class="kw">in</span> host_ports.items():</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;running </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss"> on port :</span><span class="sc">{</span>port<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    os.system(<span class="ss">f&quot;cd approved/</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss"> &amp;&amp; chmod +x run.sh &amp;&amp; HOST_PORT=</span><span class="sc">{</span>port<span class="sc">}</span><span class="ss"> ./run.sh&quot;</span>)</span></code></pre></div>
<p>which was able to install almost all of the selected challenges. DevelopersHubris originally errored out with:</p>
<pre><code>Non-resolvable parent POM for com.example:DevelopersHubris:0.0.1-SNAPSHOT: Could not transfer artifact org.springframework.boot:spring-boot-starter-parent:pom:2.7.5 from/to central (https://repo.maven.apache.org/maven2): transfer failed for https://repo.maven.apache.org/maven2/org/springframework/boot/spring-boot-starter-parent/2.7.5/spring-boot-starter-parent-2.7.5.pom and &#39;parent.relativePath&#39; points at no local POM @ line 6, column 11: Remote host terminated the handshake: SSL peer shut down incorrectly</code></pre>
<p>but, I ran again and it worked fine.</p>
<p>However, despite all of these working fine on my laptop, we run into some issues on the Droplet:</p>
<table>
<thead>
<tr class="header">
<th>Emoji</th>
<th>Title</th>
<th>Performance Impact</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>üí•</td>
<td>AlexHanlonHasTheFlag</td>
<td>100% CPU (repeated crashes)</td>
</tr>
<tr class="even">
<td>üí•</td>
<td>GoingInBlind</td>
<td>100% CPU (repeated crashes)</td>
</tr>
<tr class="odd">
<td>‚úÖ</td>
<td>DevelopersHubris</td>
<td>10% CPU</td>
</tr>
<tr class="even">
<td>üí•</td>
<td>nojs</td>
<td>100% CPU (repeated crashes)</td>
</tr>
<tr class="odd">
<td>üí•</td>
<td>xark</td>
<td>100% CPU (repeated crashes)</td>
</tr>
</tbody>
</table>
<p>So, it looks like the first two are crashing due to self signed certificates.</p>
<details>
<summary>
Show all
</summary>
<pre><code>2023-11-09T16:33:43.040751Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: &#39;8.0.31&#39;  socket: &#39;/var/run/mysqld/mysqld.sock&#39;  port: 3306  MySQL Community Server - GPL.
2023-11-09 16:34:38+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.31-1.el8 started.
2023-11-09 16:34:40+00:00 [Note] [Entrypoint]: Switching to dedicated user &#39;mysql&#39;
2023-11-09 16:34:40+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.0.31-1.el8 started.
&#39;/var/lib/mysql/mysql.sock&#39; -&gt; &#39;/var/run/mysqld/mysqld.sock&#39;
2023-11-09T16:34:41.713217Z 0 [Warning] [MY-011068] [Server] The syntax &#39;--skip-host-cache&#39; is deprecated and will be removed in a future release. Please use SET GLOBAL host_cache_size=0 instead.
2023-11-09T16:34:41.725478Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.0.31) starting as process 1
2023-11-09T16:34:41.766279Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.
2023-11-09T16:34:43.370891Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.
2023-11-09T16:34:45.659096Z 0 [System] [MY-010229] [Server] Starting XA crash recovery...
2023-11-09T16:34:45.827484Z 0 [System] [MY-010232] [Server] XA crash recovery finished.
2023-11-09T16:34:48.290338Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.
2023-11-09T16:34:48.296914Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.
2023-11-09T16:34:48.399412Z 0 [Warning] [MY-011810] [Server] Insecure configuration for --pid-file: Location &#39;/var/run/mysqld&#39; in the path is accessible to all OS users. Consider choosing a different directory.
2023-11-09T16:34:50.303363Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: &#39;8.0.31&#39;  socket: &#39;/var/run/mysqld/mysqld.sock&#39;  port: 3306  MySQL Community Server - GPL.</code></pre>
</details>
<p>And nojs was crashing due to not having Java:</p>
<pre><code>2023/11/09 17:26:20 worker 8228973497722964186 failed to initialize: failed to initialize selenium: exec: &quot;java&quot;: executable file not found in $PATH</code></pre>
and xark was crashing as well:
<details>
<summary>
Show all
</summary>
<pre><code>Listening on port 3001 in prod
crushes table doesn&#39;t exist, initializing...
node:internal/process/promises:289
            triggerUncaughtException(err, true /* fromPromise */);
            ^

Error: Connection lost: The server closed the connection.
    at Protocol.end (/app/node_modules/mysql/lib/protocol/Protocol.js:112:13)
    at Socket.&lt;anonymous&gt; (/app/node_modules/mysql/lib/Connection.js:94:28)
    at Socket.&lt;anonymous&gt; (/app/node_modules/mysql/lib/Connection.js:526:10)
    at Socket.emit (node:events:527:35)
    at endReadableNT (node:internal/streams/readable:1589:12)
    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)
    --------------------
    at Protocol._enqueue (/app/node_modules/mysql/lib/protocol/Protocol.js:144:48)
    at Connection.query (/app/node_modules/mysql/lib/Connection.js:198:25)
    at /app/node_modules/knex/lib/dialects/mysql/index.js:132:18
    at new Promise (&lt;anonymous&gt;)
    at Client_MySQL._query (/app/node_modules/knex/lib/dialects/mysql/index.js:126:12)
    at executeQuery (/app/node_modules/knex/lib/execution/internal/query-executioner.js:37:17)
    at Client_MySQL.query (/app/node_modules/knex/lib/client.js:146:12)
    at Runner.query (/app/node_modules/knex/lib/execution/runner.js:123:36)
    at Runner.queryArray (/app/node_modules/knex/lib/execution/runner.js:217:21)
    at Runner.queryArray (/app/node_modules/knex/lib/execution/runner.js:269:31) {
  fatal: true,
  code: &#39;PROTOCOL_CONNECTION_LOST&#39;
}

Node.js v21.1.0
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.</code></pre>
</details>
<p>I must appreciate the irony that DevelopersHubris was the only one working.</p>
<p><strong>Current status:</strong> Our meeting is tomorrow, and only one challenge is properly hosted.</p>
<h3 id="fixing-nojs">Fixing nojs</h3>
<p>This one seems straightforward.</p>
<p>So, it turns out that, despite the fact it worked on my machine, we need to adjust the docker image to include OpenJDK.</p>
<details>
<summary>
See modified Dockerfile
</summary>
<div class="sourceCode" id="cb23"><pre class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> debian:bookworm as builder</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">MAINTAINER</span> tnek</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> apt-get update &amp;&amp; apt-get -y install ca-certificates git golang</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD keys/deploy_id_rsa /root/.ssh/id_rsa</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN chmod 700 /root/.ssh/id_rsa</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN echo &quot;Host github.com\n\tStrictHostKeyChecking no\n&quot; &gt;&gt; /root/.ssh/config</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># RUN git config --global url.ssh://git@github.com/.insteadOf https://github.com/</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /src</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> ./go.mod ./</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> ./go.sum ./</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . .</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> go mod tidy</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> go mod vendor</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> go mod download</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> go build -installsuffix <span class="st">&#39;static&#39;</span> -o /notes-site .</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> openjdk:11 AS final</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> --from=builder /notes-site ./notes-site</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> --from=builder /src/assets ./assets</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> apt-get update &amp;&amp; apt-get install -y curl xvfb software-properties-common unzip wget libc6-amd64-cross libc6-dev firefox-esr </span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Geckodriver</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> VERSION=$(curl -sL https://api.github.com/repos/mozilla/geckodriver/releases/latest | grep tag_name | cut -d <span class="st">&#39;&quot;&#39;</span> -f 4) &amp;&amp; curl -sL <span class="st">&quot;https://github.com/mozilla/geckodriver/releases/download/$VERSION/geckodriver-$VERSION-linux-aarch64.tar.gz&quot;</span> | tar -xz -C /usr/local/bin</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Get selenium&#39;s jar</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> SELENIUM_JAR_ADDR=https://github.com/SeleniumHQ/selenium/releases/download/selenium-3.141.59/selenium-server-standalone-3.141.59.jar</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> curl -sL $SELENIUM_JAR_ADDR &gt; /usr/local/bin/selenium-server.jar</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;./notes-site&quot;</span>]</span></code></pre></div>
</details>
<p>I‚Äôve waited for <code>go build -installsuffix 'static' -o /notes-site .</code> to finish for about 10 hours now. Go usually compiles super quickly, so I‚Äôm not sure what‚Äôs going wrong. I bet there‚Äôs an easy solution, but iterative development is hard when you have to wait hours on a slow machine. I‚Äôm giving up and trying a previous year. This feels like a performance limitation.</p>
<h2 id="are-challenges-from-2021-easy-to-host">Are challenges from 2021 easy to host?</h2>
<pre><code>https://squarectf.com/2021/data/its-just-an-xor.zip
https://squarectf.com/2021/data/im-a-credential-ghoul.zip
https://squarectf.com/2021/data/out-of-cash.zip
https://squarectf.com/2021/data/korean-space-program.zip
https://squarectf.com/2021/data/memory-safe-hex-decode.zip
https://squarectf.com/2021/data/card-theft.zip
https://squarectf.com/2021/data/huge-primes.zip
https://squarectf.com/2021/data/collatzeral-damage.zip
https://squarectf.com/2021/data/burnt-bread.zip
https://squarectf.com/2021/data/gil-triangle.zip
https://squarectf.com/2021/data/memory-safe-strcmp.zip</code></pre>
<details>
<summary>
See download script
</summary>
<div class="sourceCode" id="cb25"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>square_zips <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2021/data/its-just-an-xor.zip</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2021/data/im-a-credential-ghoul.zip</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2021/data/out-of-cash.zip</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2021/data/korean-space-program.zip</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2021/data/memory-safe-hex-decode.zip</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2021/data/card-theft.zip</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2021/data/huge-primes.zip</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2021/data/collatzeral-damage.zip</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2021/data/burnt-bread.zip</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2021/data/gil-triangle.zip</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="st">https://squarectf.com/2021/data/memory-safe-strcmp.zip</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span>.strip().split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>prefix <span class="op">=</span> <span class="st">&#39;https://squarectf.com/2022/&#39;</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>zip_dir <span class="op">=</span> <span class="st">&#39;./zips&#39;</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>unzip_dir <span class="op">=</span> <span class="st">&#39;./unzips&#39;</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>Path(zip_dir).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>) <span class="co"># make directory if it doesn&#39;t exist</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>Path(unzip_dir).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="co">#  def download(url):</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  os.system(f&#39;wget --directory-prefix &quot;{zip_dir}&quot; {url}&#39;) # string interpolation into shell commands is dangerous, fyi.</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="co">#  for url in square_zips: # download all zip files</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  download(url)</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a><span class="co">#  for file in os.listdir(zip_dir): # unzip all zip files</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  downloaded_file = os.path.join(zip_dir, file)</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  with zipfile.ZipFile(downloaded_file, &#39;r&#39;) as zip_ref:</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>        <span class="co">#  zip_ref.extractall(unzip_dir)</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a><span class="co">#  for file in os.listdir(unzip_dir): # unzip all zip files</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  target = os.path.join(unzip_dir, file)</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  has_dockerfile = len(list(Path(target).glob(&#39;**/run.sh&#39;))) &gt; 0</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  dockerfile_status = &#39;‚úÖ&#39; if has_dockerfile else &#39;‚ùå&#39;</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  print(dockerfile_status, file)</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>approved <span class="op">=</span> (<span class="st">&#39;AlexHanlonHasTheFlag&#39;</span>, <span class="st">&#39;xark&#39;</span>, <span class="st">&#39;GoingInBlind&#39;</span>, <span class="st">&#39;nojs&#39;</span>, <span class="st">&#39;DevelopersHubris&#39;</span>)</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>approved_dir <span class="op">=</span> <span class="st">&#39;./approved&#39;</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>Path(approved_dir).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>) <span class="co"># make directory if it doesn&#39;t exist</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download(url):</span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>    os.system(<span class="ss">f&#39;wget --directory-prefix &quot;</span><span class="sc">{</span>zip_dir<span class="sc">}</span><span class="ss">&quot; </span><span class="sc">{</span>url<span class="sc">}</span><span class="ss">&#39;</span>) <span class="co"># string interpolation into shell commands is dangerous, fyi.</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> url <span class="kw">in</span> square_zips: <span class="co"># download all zip files</span></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>    download(url)</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(zip_dir): <span class="co"># unzip all zip files</span></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>    downloaded_file <span class="op">=</span> os.path.join(zip_dir, <span class="bu">file</span>)</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> zipfile.ZipFile(downloaded_file, <span class="st">&#39;r&#39;</span>) <span class="im">as</span> zip_ref:</span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>        zip_ref.extractall(unzip_dir)</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a><span class="co">#  for folder in approved:</span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  source = os.path.join(unzip_dir, folder)</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  destination = os.path.join(approved_dir, folder)</span></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  shutil.move(source, destination)</span></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(unzip_dir): <span class="co"># unzip all zip files</span></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>    target <span class="op">=</span> os.path.join(unzip_dir, <span class="bu">file</span>)</span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>    has_dockerfile <span class="op">=</span> <span class="bu">len</span>(<span class="bu">list</span>(Path(target).glob(<span class="st">&#39;**/Dockerfile&#39;</span>))) <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>    dockerfile_status <span class="op">=</span> <span class="st">&#39;‚úÖ&#39;</span> <span class="cf">if</span> has_dockerfile <span class="cf">else</span> <span class="st">&#39;‚ùå&#39;</span></span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(dockerfile_status, <span class="bu">file</span>)</span></code></pre></div>
</details>
<p>So, 2021:</p>
<pre><code>‚úÖ re-its-just-an-xor
‚úÖ crypto-im-a-credential-ghoul
‚úÖ out-of-cash
‚úÖ inv-characters
‚ùå rust-rev-2
‚úÖ card-theft
‚úÖ hugeprimes
‚ùå crypto-collatzeral-damage
‚úÖ burnt-bread
‚úÖ gil-triangle
‚ùå rust-rev-1</code></pre>
<p>I‚Äôm sad I don‚Äôt get to geek out about about Rust, as <code>rust-rev-1</code> and <code>rust-rev-2</code> don‚Äôt seem easy to host, but this is at least showing progress.</p>
<p>Using an abomination of a Bash/Python one-liner, I found there‚Äôs quite a lot of socat-based challanges. These should all work as well. (Though, I haven‚Äôt tested them.) They‚Äôre just netcat based, and I want some browser-based challenges as well.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> find . <span class="at">-iname</span> <span class="st">&quot;Dockerfile&quot;</span> <span class="at">-exec</span> python3 <span class="at">-c</span> <span class="st">&quot;with open(&#39;{}&#39;) as f: print(&#39;üê± {}&#39; if any(map(lambda x: &#39;socat&#39; in x, f.readlines())) else &#39;‚úÖ {}&#39;)&quot;</span> <span class="dt">\;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">üê±</span> ./re-its-just-an-xor/Dockerfile</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="ex">‚úÖ</span> ./crypto-im-a-credential-ghoul/Dockerfile</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="ex">üê±</span> ./out-of-cash/Dockerfile</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="ex">‚úÖ</span> ./inv-characters/src-do-not-share/Dockerfile</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="ex">üê±</span> ./card-theft/Dockerfile</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="ex">‚úÖ</span> ./hugeprimes/Dockerfile</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="ex">üê±</span> ./burnt-bread/Dockerfile</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="ex">üê±</span> ./gil-triangle/Dockerfile</span></code></pre></div>
<h3 id="hugeprimes">HugePrimes</h3>
<p>Lets try <code>hugeprimes</code> ü§û.</p>
<p>Let‚Äôs look at its Dockerfile (comments removed):</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> node:16</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /usr/src/app</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> package.json ./</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> npm install</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . .</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPOSE</span> 8080</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [ <span class="st">&quot;node&quot;</span>, <span class="st">&quot;server.js&quot;</span> ]</span></code></pre></div>
<p>This is a tiny Dockerfile. There‚Äôs a chance this might not fight back‚Ä¶</p>
<figure>
<img src="../assets/square-ctf/image-20231109180221535.png" alt="HugePrimes works!" /><figcaption aria-hidden="true">HugePrimes works!</figcaption>
</figure>
<p>This is huge! It works.üéâ</p>
<p>I‚Äôm currently at <strong>two</strong> non-netcat Dockerfiles, which is a <strong>100%</strong> improvement. At this rate, we‚Äôre going to have all of the browser challenges working in no time.</p>
<figure>
<img src="https://imgs.xkcd.com/comics/extrapolating.png" alt="Extrapolating - XKCD.com" /><figcaption aria-hidden="true">Extrapolating - XKCD.com</figcaption>
</figure>
<h2 id="inv-characters">inv-characters</h2>
<p>This challenge has the same super simple Dockerfile listed above!</p>
<p>And it runs!</p>
<figure>
<img src="../assets/square-ctf/image-20231109181715740.png" alt="Korean Space Agency Login Form" /><figcaption aria-hidden="true">Korean Space Agency Login Form</figcaption>
</figure>
<p>I‚Äôm calling that <strong>three</strong> total challenges. üéâ</p>
<aside>
<p>And yes, several hours later, my $6 Digital Ocean Droplet is still maxed out trying to build one the docker image for <a href="https://squarectf.com/2022/nojs.html">nojs</a>.</p>
If you are represent a company interested in supporting college students passionate about cybersecurity, please feel free to <a href="/contact.html">contact me</a>.
</aside>
<h2 id="our-status-so-far">Our status so far:</h2>
<p><strong>Legend:</strong></p>
<ul>
<li>‚úÖ has a Dockerfile, works</li>
<li>üí• Worked on my machine, but crashed on the server</li>
<li>üñ•Ô∏è Used SSH, and I didn‚Äôt want to host that.</li>
<li>üê± uses socat (connect through netcat)</li>
<li>‚ùå has no Dockerfile; usually isn‚Äôt easily hosted</li>
</ul>
<pre><code>‚úÖ inv-characters
‚úÖ hugeprimes
‚úÖ DevelopersHubris 
üí• AlexHanlonHasTheFlag 
üí• GoingInBlind         
üí• nojs                 
üí• xark         
üñ•Ô∏è crypto-im-a-credential-ghoul
üê± ez-pwn-1
üê± ez-pwn-2
üê± ROPlike-easy
üê± ROPlike-medium
üê± ROPlike-hard
üê± re-its-just-an-xor
üê± out-of-cash
üê± card-theft
üê± burnt-bread
üê± gil-triangle
‚ùå rust-rev-2
‚ùå crypto-collatzeral-damage
‚ùå rust-rev-1
‚ùå ez-re-1
‚ùå emoji_hunt
‚ùå sqUARe_paymenT_terminal_pt1
‚ùå hard-copy
‚ùå its-right-there
‚ùå yet-another-reversing-activity
‚ùå BLOCKchain</code></pre>
<h2 id="a-new-hope">A new hope</h2>
<p>I want at least 5 challenges to cover on Friday, but it bugs me that several challenges keep crashing on our droplet.</p>
<p>I see three paths forward:</p>
<ol type="1">
<li>Go back another year</li>
<li>Try and resolve the Docker issues</li>
</ol>
<p>Well, I liked what I saw of AlexHanlonHasTheFlag when it was working, so I‚Äôll try that again.</p>
<h2 id="resource-limiations-part-2">Resource limiations, part 2</h2>
<p>I‚Äôm giving up on nojs. I‚Äôve waited for too many hours for the Docker image to build, to no avail.</p>
<p>I‚Äôm going to try AlexHanlonHasTheFlag, because we‚Äôve covered SQL injections before, and I might be able to fix the errors.</p>
<p>Just checking:</p>
<figure>
<img src="../assets/square-ctf/image-20231109185744020.png" alt="A form" /><figcaption aria-hidden="true">A form</figcaption>
</figure>
<p>Apparently, the logs I saw the last time I ran it are actually the exact same I see in my laptop. However, the db image is definitely failing.</p>
<p>Going into each Dockerfile, I notice that both the db application and the Java application run without error. However, the db application closes immediately and exits.</p>
<p>However, adding a bash command to the end of the Dockerfile works to keep the container alive, as long as the file is run with <code>-t</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep alive</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;bash&quot;</span>] </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># or consider https://stackoverflow.com/a/30209974</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [<span class="st">&quot;sleep&quot;</span>, <span class="st">&quot;infinity&quot;</span>] </span></code></pre></div>
<p>I tested the second solution, and it seemed to keep the container alive with no worries.</p>
<p>Unfortunately, this did not resolve my issue, and running <code>docker compose</code> continued to use 100% of my CPU repeatedly boot-looping the db container, with no errors to explain a crash.</p>
<p><a href="https://serverfault.com/a/1091663">This StackOverflow response</a> says that these errors are produced when MySql is trying to run with too little RAM. Yeah, that checks out.</p>
<p>However, we‚Äôre literally storing <em>one</em> record for these challenges, so the idea it needs more than a megabyte of RAM seems absurd.</p>
<p>They suggest:</p>
<blockquote>
<p>And then again, you could just increase RAM on your server if you can afford it.</p>
</blockquote>
<p>ü•≤</p>
<p>So, I yoinky sploinkied <a href="https://serverfault.com/a/1091663">the configuration file</a> into <code>mysql.config</code>, and added the line:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> ./mysql.config /etc/mysql/conf.d</span></code></pre></div>
<p>Here‚Äôs my testing command for the Dockerfile, for personal reference:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> host.py <span class="kw">&amp;&amp;</span> <span class="fu">sleep</span> 20 <span class="kw">&amp;&amp;</span> <span class="kw">(</span> <span class="ex">docker</span> ps <span class="kw">|</span> <span class="fu">grep</span> alexhanlonhastheflag-db <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;{ print $1 }&#39;</span> <span class="kw">|</span> <span class="fu">xargs</span> docker logs <span class="kw">)</span> <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> approved/AlexHanlonHasTheFlag/ <span class="kw">&amp;&amp;</span> <span class="ex">docker</span> compose down <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> ../..</span></code></pre></div>
<p>Then, I stumbled upon <a href="https://github.com/alexanderkoller/low-memory-mysql">this GitHub repo</a> for configuring MySql to run with low memory, but even that wasn‚Äôt enough.</p>
<p>If I had more time, I‚Äôd migrate everything to SQLite, and it would all work. However, I guess we‚Äôre just picking a different strategy now.</p>
<p>It looks like the minimum system requirements for MySql is around 2 GB RAM, which is above the System RAM of 1GB.</p>
<pre><code>OS: Ubuntu 22.04.3 LTS x86_64 
Host: Droplet 20171212 
Kernel: 5.15.0-84-generic 
Uptime: 42 days, 55 mins 
Packages: 750 (dpkg), 5 (snap) 
Shell: bash 5.1.16 
Resolution: 1024x768 
Terminal: /dev/pts/0 
CPU: DO-Regular (1) @ 2.199GHz 
GPU: 00:02.0 Red Hat, Inc. Virtio GPU 
Memory: 572MiB / 957MiB</code></pre>
<h2 id="back-to-ez-pwn-1">Back to ez-pwn-1</h2>
<p>I looked at <a href="https://ctftime.org/writeup/35997">the solution</a>, and found that people were expected to use netcat to connect. That would have been helpful to put in the README.md, ngl. I had issues originally because I thought they expected people to use the browser. From netcat, it works perfectly. I‚Äôm sorry I doubted you, ez-pwn-1. üôè</p>
<p>Well, that‚Äôs a relief. I probably should have looked through the walkthroughs a while ago.</p>
<p>So, that gives us these challenges for Friday:</p>
<ul>
<li><a href="https://squarectf.com/2022/ezpwn1.html">EZ pwn 1</a></li>
<li><a href="https://squarectf.com/2022/ezpwn2.html">EZ pwn 2</a></li>
<li><a href="https://squarectf.com/2022/developershubris.html">Developer‚Äôs Hubris</a></li>
<li><a href="https://squarectf.com/2021/hugeprimes.html">Huge Primes</a></li>
<li><a href="https://squarectf.com/2021/koreanspaceprogram.html">Korean Space Program</a> A.K.A. Inv-characters</li>
</ul>
<p>At this point, I give everything a good old <code>rm * -rf</code> and I start with the challenges from above.</p>
<p>I write a new hosting script:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co">This script assumes it is next to a directory structure like:</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">        approved</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">        ‚îú‚îÄ‚îÄ DevelopersHubris</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">        ‚îú‚îÄ‚îÄ ez-pwn-1</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">        ‚îú‚îÄ‚îÄ ez-pwn-2</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">        ‚îú‚îÄ‚îÄ hugeprimes</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">        ‚îî‚îÄ‚îÄ inv-characters</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">&quot;&quot;&quot;</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>host_ports <span class="op">=</span> {</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;DevelopersHubris&quot;</span>: <span class="dv">8001</span>,</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ez-pwn-1&quot;</span>: <span class="dv">8002</span>,</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ez-pwn-2&quot;</span>: <span class="dv">8003</span>,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;hugeprimes&quot;</span>: <span class="dv">8004</span>,</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;inv-characters&quot;</span>: <span class="dv">8005</span>,</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> go_to_script_dir():</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>        os.chdir(os.path.dirname(<span class="va">__file__</span>))</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> folder, port <span class="kw">in</span> host_ports.items():</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;starting </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss"> on port </span><span class="sc">{</span>port<span class="sc">}</span><span class="ss"> &quot;</span>, end<span class="op">=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>        go_to_script_dir()</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>        os.chdir(<span class="ss">f&quot;approved/</span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> os.path.isfile(<span class="st">&#39;run.sh&#39;</span>):</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">&quot;using run.sh&quot;</span>)</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>                os.system(<span class="ss">f&quot;chmod +x run.sh &amp;&amp; HOST_PORT=</span><span class="sc">{</span>port<span class="sc">}</span><span class="ss"> ./run.sh&quot;</span>)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>                path_to_dockerfile <span class="op">=</span> os.path.dirname(<span class="bu">list</span>(Path(<span class="st">&#39;.&#39;</span>).glob(<span class="st">&#39;**/Dockerfile&#39;</span>))[<span class="dv">0</span>].absolute())</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>                os.chdir(path_to_dockerfile)</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="st">&quot;using docker&quot;</span>)</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> folder <span class="kw">in</span> (<span class="st">&#39;hugeprimes&#39;</span>, <span class="st">&#39;inv-characters&#39;</span>):</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>                        docker_port <span class="op">=</span> <span class="dv">8080</span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>                        docker_port <span class="op">=</span> <span class="dv">8000</span></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>                os.system(<span class="ss">f&quot;docker build -t </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss"> . &amp;&amp; docker run -d --restart unless-stopped -p </span><span class="sc">{</span>port<span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>docker_port<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>folder<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<p>Running all of these Docker images bumps our RAM up from 400M/1G to 700M/1G, so we‚Äôre kinda pushing our Droplet to its limits. I‚Äôm sure it‚Äôll be fine.</p>
<h2 id="allow-all-solutions-on-the-firewall">Allow all solutions on the firewall</h2>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ufw allow 8001:8005/tcp <span class="co"># warning: this opens our insecure apps to the world</span></span></code></pre></div>
<h1 id="ctfd-resources">CTFd resources</h1>
<p>Club members should check the Google Drive for the CTFd resources for this event.</p>


    </article>
  </main>

<footer>
  <style>
    .edit {
      margin-bottom: 1em;
    }
    .page-bottom {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2em;
    }
  </style>

  <div class="page-bottom">
    <div class="copyright">
      &copy; 2023 Zack Sargent
    </div>
    <div class="top">
      <a href="javascript:window.scrollTo({ top: 0, behavior: 'smooth' })">
        Go to Top
      </a>
    </div>
  </div>

  
    <details>
      <summary>See edit history for "How to host Square CTF for practice"</summary>
      <dl class="edits">
        
          <div class="edit">
            <dt>
              Zack Sargent edited this page on 
              <time datetime="2023-11-10T17:36:12-05:00">
                Friday, November 10, 2023 at 05:36 PM
              </time>
            </dt>
            <dd>
              1 file changed, 1 insertion(+), 1 deletion(-)
            </dd>
          </div>
        
          <div class="edit">
            <dt>
              Zack Sargent edited this page on 
              <time datetime="2023-11-10T02:15:07-05:00">
                Friday, November 10, 2023 at 02:15 AM
              </time>
            </dt>
            <dd>
              1 file changed, 23 insertions(+), 18 deletions(-)
            </dd>
          </div>
        
          <div class="edit">
            <dt>
              Zack Sargent edited this page on 
              <time datetime="2023-11-10T01:29:37-05:00">
                Friday, November 10, 2023 at 01:29 AM
              </time>
            </dt>
            <dd>
              1 file changed, 504 insertions(+), 59 deletions(-)
            </dd>
          </div>
        
          <div class="edit">
            <dt>
              Zack Sargent edited this page on 
              <time datetime="2023-11-08T23:23:21-05:00">
                Wednesday, November 08, 2023 at 11:23 PM
              </time>
            </dt>
            <dd>
              1 file changed, 375 insertions(+)
            </dd>
          </div>
        
      </dl>
    </details>
  
</footer>

  <script>
    anchors.add('h1:not(.post-title), h2, h3, h4, h5, h6');
  </script>
</body>

</html>
