<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
  <meta name="author" content="Zack Sargent">
  <meta property="article:author" content="Zack Sargent">
  <meta name="keywords" content="nkcyber, cybersecurity">
  <title> OWASP Juice Shop Sensitive Data Exposure Walkthrough </title>
  <meta name="twitter:title" content="OWASP Juice Shop Sensitive Data Exposure Walkthrough">
  <meta name="twitter:text:title" content="OWASP Juice Shop Sensitive Data Exposure Walkthrough">
  <meta name="twitter:description" content="A walkthrough for some of the Sensitive Data Exposure problems in OWASP&#39;s Juice Shop">
  <meta name="description" content="A walkthrough for some of the Sensitive Data Exposure problems in OWASP&#39;s Juice Shop">
  <meta name="og:description" content="A walkthrough for some of the Sensitive Data Exposure problems in OWASP&#39;s Juice Shop">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://zack.fyi/blog/juice-shop-data-exposure.html">
  <link rel="canonical" href="https://zack.fyi/blog/juice-shop-data-exposure.html">
  <meta property="article:published_time" content="2023-10-03T00:00:00+00:00">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="/assets/common.css" > 
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
</head>

<body>
  <header>
    <nav id="top-nav">
        <div class="logo">
            <a href="/">
                Zack Sargent
            </a>
        </div>
        <div class="links">
            <a href="/blog/index.html">Blog</a>
            <a href="/contact.html">Contact</a>
        </div>
    </nav>
</header>

  <main>
    <article class="post">
      <h1 class="post-title"> OWASP Juice Shop Sensitive Data Exposure Walkthrough</h1>
      <div id="post-meta">
        <span id="date-published">
          <i class="fa fa-calendar" aria-hidden="true"></i>
          <time datetime="2023-10-03" pubdate="pubdate">Tuesday, October  3, 2023</time>
        </span>
        <span id="reading-time">
          <i class="fa fa-clock-o" aria-hidden="true"></i> 
          14 mins
        </span>
        <span class="tags">
          <a href="/tag/nkcyber.html" class="tag">nkcyber</a> <a href="/tag/cybersecurity.html" class="tag">cybersecurity</a>
        </span>
      </div>

    <style>
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<details id="table-of-contents" class="toc" role="doc-toc">
<summary id="table-of-contents-header"> Table of Contents </summary>

<ul>
<li><a href="#solutions">Solutions</a>
<ul>
<li><a href="#confidential-document">Confidential Document</a></li>
<li><a href="#exposed-metrics">Exposed Metrics</a></li>
<li><a href="#meta-geo-stalking">Meta Geo Stalking</a></li>
<li><a href="#poison-null-byte">Poison Null Byte</a></li>
<li><a href="#forgotten-sales-backup">Forgotten Sales Backup</a></li>
<li><a href="#forgotten-developer-backup">Forgotten Developer Backup</a></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>

</details>

<p>This writeup is to help <a href="https://www.nku.edu/academics/informatics/beyond/student-organizations/nkcyber.html">NKCyber</a> Club Members walk through the steps for the first few solutions to the Sensitive Data Exposure section of <a href="https://owasp.org/www-project-juice-shop/">OWASP Juice Shop</a>. Similar articles include <a href="/blog/juice-shop.html">instructions for administering OWASP’s Juice Shop</a> and <a href="/blog/juice-shop-answers.html">last week’s XSS solutions</a>.</p>
<h1 id="solutions">Solutions</h1>
<h2 id="confidential-document">Confidential Document</h2>
<blockquote>
<p>Access a confidential document. (Difficulty Level: 1)</p>
</blockquote>
<p>The description alone doesn’t give a lot to work with, so it’s worth taking a look at the first hint:</p>
<blockquote>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* /ftp directory browsing and file download */</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;/ftp&quot;</span><span class="op">,</span> serveIndexMiddleware<span class="op">,</span> <span class="fu">serveIndex</span>(<span class="st">&quot;ftp&quot;</span><span class="op">,</span> { <span class="dt">icons</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;/ftp(?!/quarantine)/:file&quot;</span><span class="op">,</span> <span class="fu">fileServer</span>())<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;/ftp/quarantine/:file&quot;</span><span class="op">,</span> <span class="fu">quarantineServer</span>())<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">/* /encryptionkeys directory browsing */</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;/encryptionkeys&quot;</span><span class="op">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  serveIndexMiddleware<span class="op">,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">serveIndex</span>(<span class="st">&quot;encryptionkeys&quot;</span><span class="op">,</span> { <span class="dt">icons</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">view</span><span class="op">:</span> <span class="st">&quot;details&quot;</span> })</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;/encryptionkeys/:file&quot;</span><span class="op">,</span> <span class="fu">keyServer</span>())<span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">/* /logs directory browsing */</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;/support/logs&quot;</span><span class="op">,</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  serveIndexMiddleware<span class="op">,</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">serveIndex</span>(<span class="st">&quot;logs&quot;</span><span class="op">,</span> { <span class="dt">icons</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">view</span><span class="op">:</span> <span class="st">&quot;details&quot;</span> })</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;/support/logs/:file&quot;</span><span class="op">,</span> <span class="fu">logFileServer</span>())<span class="op">;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">/* Swagger documentation for B2B v2 endpoints */</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;/api-docs&quot;</span><span class="op">,</span> swaggerUi<span class="op">.</span><span class="at">serve</span><span class="op">,</span> swaggerUi<span class="op">.</span><span class="fu">setup</span>(swaggerDocument))<span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(express<span class="op">.</span><span class="fu">static</span>(path<span class="op">.</span><span class="fu">resolve</span>(<span class="st">&quot;frontend/dist/frontend&quot;</span>)))<span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="fu">cookieParser</span>(<span class="st">&quot;kekse&quot;</span>))<span class="op">;</span></span></code></pre></div>
</blockquote>
<p>Here, we see a lot of routes defined on an <a href="https://expressjs.com/">Express.js</a> router, with <a href="https://expressjs.com/en/4x/api.html#app.use">app.use</a>.</p>
<aside>
<p><strong>What is Express.js?</strong></p>
<p>In basic terms, websites have two main parts:</p>
<ol type="1">
<li>The frontend (the HTML, JS, and CSS that your users interact with)</li>
<li>The backend (the servers that send the data to the client)</li>
</ol>
<p>When picking frontend and backend technologies, there are many options to choose from, but many frontends involve writing JavaScript, as it is the most commonly supported language to add interactivity to webpages.</p>
<p>It’s possible to write the backend in a different language (e.g. Java, C#, Python, Go, etc.), but for convinence it can be nice to keep everything in the same language (i.e. JavaScript).</p>
<p>From there, we need to run JavaScript on the backend, which we can do with <a href="https://nodejs.org/en">Node.js</a>, which is based on <a href="https://v8.dev/">the same engine</a> that makes Chrome execute JavaScript quickly on the frontend.</p>
<p>From there, <a href="https://expressjs.com/">Express.js</a> is a library that makes it simple to create a server in JavaScript.</p>
<p>Here is an example web server:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> express <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;express&#39;</span>) <span class="co">// require the Express.js library</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> app <span class="op">=</span> <span class="fu">express</span>() <span class="co">// create a server that will respond to requests</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> port <span class="op">=</span> <span class="dv">3000</span> <span class="co">// The port to listen for requests on</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">// listen on the base route `/` and respond &quot;Hello World!&quot; to all requests</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> { <span class="co">// req stands for request, res stands for result</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">send</span>(<span class="st">&#39;Hello World!&#39;</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">// actually start the server</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">listen</span>(port<span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`Example app listening on port </span><span class="sc">${</span>port<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>— <cite><a href="https://expressjs.com/en/starter/hello-world.html">Hello world example</a></cite> (comments mine)</p>
</aside>
<p>For each line that we see <code>app.use</code>, we can imagine we’re taking some part of the URL, and doing something special when we navigate to that path.</p>
<p>Let’s take a look at the first line, for example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&quot;/ftp&quot;</span><span class="op">,</span> serveIndexMiddleware<span class="op">,</span> <span class="fu">serveIndex</span>(<span class="st">&quot;ftp&quot;</span><span class="op">,</span> { <span class="dt">icons</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span></code></pre></div>
<p>The <code>app</code> (defined elsewhere) will match all routes starting with <code>/ftp</code>, and then serve an index of all of the files to the user. Then, it will call some function <a href="https://www.npmjs.com/package/serve-index"><code>serveIndex</code></a> with the parameter <code>"ftp"</code>. We can look up that function, and find where it came from.</p>
<p>Looking at the npm page for <a href="https://www.npmjs.com/package/serve-index">serve-index</a>:</p>
<blockquote>
<p>The <code>path</code> is based off the <code>req.url</code> value, so a <code>req.url</code> of <code>'/some/dir</code> with a <code>path</code> of <code>'public'</code> will look at <code>'public/some/dir'</code>. If you are using something like <code>express</code>, you can change the URL “base” with <code>app.use</code> (see the express example).</p>
</blockquote>
<p>So, great! Let’s try going to <code>/ftp</code> on the server, and seeing what happens.</p>
<figure>
<img src="../assets/juice-shop/sensitive-data/image-20231003213243469.png" alt="We find an FTP server!" /><figcaption aria-hidden="true">We find an FTP server!</figcaption>
</figure>
<p>Woah, neat! It creates an index of all of the files on the FTP server.</p>
<p>Some of them are pretty boring. Here’s <code>legal.md</code>, for example:</p>
<pre><code># Legal Information

Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy
eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam
voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet
clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit
... [document continues]</code></pre>
<p>However, one document in particular stands out, <code>acquisitions.md</code>:</p>
<pre><code># Planned Acquisitions

&gt; This document is confidential! Do not distribute!
... [document continues]</code></pre>
<p>This seems like the confidential document.</p>
<p>Once we have requested this file, we can return to the home page at <code>/</code>.</p>
<p>From there, we should get our flag for the challenge Confidential Document.</p>
<h2 id="exposed-metrics">Exposed Metrics</h2>
<blockquote>
<p>Find the endpoint that serves usage data to be scraped by <a href="https://github.com/prometheus/prometheus">a popular monitoring system</a>. (Difficulty Level: 1)</p>
</blockquote>
<p>Looking at the problem description, I saw that there was a link to the Prometheus monitoring tool, which I had never heard of before.</p>
<p>I searched “where is prometheus default endpoint” on Google, and got the featured snippet:</p>
<blockquote>
<p>Starting Prometheus You can also verify that Prometheus is serving metrics about itself by navigating to its own metrics endpoint: http<strong>://localhost:9090/metrics</strong>.</p>
<p>— <cite><a href="https://prometheus.io/docs/introduction/first_steps/#:~:text=Starting%20Prometheus,-To%20start%20Prometheus&text=You%20can%20also%20verify%20that,%3A%2F%2Flocalhost%3A9090%2Fmetrics.">Prometheus.io</a></cite></p>
</blockquote>
<p>So, I went to <code>/metrics</code>, and got the flag.</p>
<p>Looking through the code they provided in the hint, we can find the route defined on line 4.</p>
<details>
<summary>
See full code
</summary>
<div class="sourceCode" id="cb6"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Serve metrics */</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>let metricsUpdateLoop<span class="op">:</span> <span class="dt">any</span><span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>const Metrics <span class="op">=</span> metrics<span class="op">.</span><span class="fu">observeMetrics</span>()<span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&quot;/metrics&quot;</span><span class="op">,</span> metrics<span class="op">.</span><span class="fu">serveMetrics</span>())<span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>errorhandler<span class="op">.</span><span class="at">title</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>config<span class="op">.</span><span class="fu">get</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;application.name&quot;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>)<span class="sc">}</span><span class="vs"> (Express </span><span class="sc">${</span>utils<span class="op">.</span><span class="fu">version</span>(<span class="st">&quot;express&quot;</span>)<span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>const registerWebsocketEvents <span class="op">=</span> <span class="fu">require</span>(<span class="st">&quot;./lib/startup/registerWebsocketEvents&quot;</span>)<span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>const customizeApplication <span class="op">=</span> <span class="fu">require</span>(<span class="st">&quot;./lib/startup/customizeApplication&quot;</span>)<span class="op">;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>export async <span class="kw">function</span> <span class="fu">start</span>(readyCallback<span class="op">:</span> <span class="dt">any</span>) {</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  const datacreatorEnd <span class="op">=</span> startupGauge<span class="op">.</span><span class="fu">startTimer</span>({ task<span class="op">:</span> <span class="st">&quot;datacreator&quot;</span> })<span class="op">;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  await sequelize<span class="op">.</span><span class="fu">sync</span>({ force<span class="op">:</span> true })<span class="op">;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  await <span class="fu">datacreator</span>()<span class="op">;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datacreatorEnd</span>()<span class="op">;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  const port <span class="op">=</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">PORT</span> <span class="op">??</span> config<span class="op">.</span><span class="fu">get</span>(<span class="st">&quot;server.port&quot;</span>)<span class="op">;</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">BASE_PATH</span> <span class="op">=</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">BASE_PATH</span> <span class="op">??</span> config<span class="op">.</span><span class="fu">get</span>(<span class="st">&quot;server.basePath&quot;</span>)<span class="op">;</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  metricsUpdateLoop <span class="op">=</span> Metrics<span class="op">.</span><span class="fu">updateLoop</span>()<span class="op">;</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  server<span class="op">.</span><span class="fu">listen</span>(port<span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    logger<span class="op">.</span><span class="fu">info</span>(</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>      colors<span class="op">.</span><span class="fu">cyan</span>(<span class="vs">`Server listening on port </span><span class="sc">${</span>colors<span class="op">.</span><span class="fu">bold</span>(<span class="vs">`</span><span class="sc">${</span>port<span class="sc">}</span><span class="vs">`</span>)<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    startupGauge<span class="op">.</span><span class="fu">set</span>({ task<span class="op">:</span> <span class="st">&quot;ready&quot;</span> }<span class="op">,</span> (Date<span class="op">.</span><span class="fu">now</span>() <span class="op">-</span> startTime) <span class="op">/</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">if</span> (<span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">BASE_PATH</span> <span class="op">!==</span> <span class="st">&quot;&quot;</span>) {</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>      logger<span class="op">.</span><span class="fu">info</span>(</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        colors<span class="op">.</span><span class="fu">cyan</span>(</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>          <span class="vs">`Server using proxy base path </span><span class="sc">${</span>colors<span class="op">.</span><span class="fu">bold</span>(</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>            <span class="vs">`</span><span class="sc">${</span><span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">BASE_PATH</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>          )<span class="sc">}</span><span class="vs"> for redirects`</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">registerWebsocketEvents</span>(server)<span class="op">;</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">if</span> (readyCallback) {</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">readyCallback</span>()<span class="op">;</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>export <span class="kw">function</span> <span class="fu">close</span>(exitCode<span class="op">:</span> <span class="dt">number</span> <span class="op">|</span> <span class="dt">undefined</span>) {</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">if</span> (server) {</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clearInterval</span>(metricsUpdateLoop)<span class="op">;</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    server<span class="op">.</span><span class="fu">close</span>()<span class="op">;</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">if</span> (exitCode <span class="op">!==</span> undefined) {</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    <span class="bu">process</span><span class="op">.</span><span class="fu">exit</span>(exitCode)<span class="op">;</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</details>
<div class="sourceCode" id="cb7"><pre class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&quot;/metrics&quot;</span><span class="op">,</span> metrics<span class="op">.</span><span class="fu">serveMetrics</span>())<span class="op">;</span></span></code></pre></div>
<p>Once we see that the server routes to that path, we know we can visit it.</p>
<p>From there, we can navigate back to the homepage to get the flag.</p>
<h2 id="meta-geo-stalking">Meta Geo Stalking</h2>
<blockquote>
<p>Determine the answer to John’s security question by looking at an upload of him to the Photo Wall and use it to reset his password via the Forgot Password mechanism. (Difficulty Level: 2)</p>
</blockquote>
<p>To start this challenge, I went to the Photo Wall:</p>
<figure>
<img src="../assets/juice-shop/sensitive-data/image-20231003232101797.png" alt="Some images don’t show up, but I assume that’s okay." /><figcaption aria-hidden="true">Some images don’t show up, but I assume that’s okay.</figcaption>
</figure>
<p>Looking through the gallery of happy juice connoisseurs, we stumble upon a post by j0hNny, who very well might be the John from the problem description:</p>
<figure>
<img src="../assets/juice-shop/sensitive-data/image-20231003232249312.png" alt="He’s holding a smoothie, in the woods." /><figcaption aria-hidden="true">He’s holding a smoothie, in the woods.</figcaption>
</figure>
<p>Okay, so let’s go to the Forgot Password page, and see what information we need to find from this image.</p>
<p>First, we can enter John’s email: <code>john@juice-sh.op</code>.</p>
<figure>
<img src="../assets/juice-shop/sensitive-data/image-20231003232445267.png" alt="The Forgot Password form" /><figcaption aria-hidden="true">The Forgot Password form</figcaption>
</figure>
<p>It looks like John has selected “What’s your favorite place to go hiking?” as his security question, and then conveniently posted a picture of him going hiking.</p>
<p>Now we just need to figure out where this photo was taken.</p>
<p>Unfortunately, <a href="https://www.youtube.com/@georainbolt">Rainbolt</a> seems to be too busy to figure this one out, and I’m not very good at GeoGuessr. We’re going to have to inspect the image he’s posted more carefully.</p>
<p>Luckily, there’s more to an image than just the visuals. Many common file types (including <code>.jpg</code>, <code>.png</code>, <code>.webp</code>, and more) include something called <a href="https://en.wikipedia.org/wiki/Exif">Exif data</a> which stores additional information about the image, including camera settings, image metrics, date and time information, and potentially the geolocation where the image was taken.</p>
<p>Using your provided Kali VM, you may note that <a href="https://www.kali.org/tools/exiv2/"><code>exiv2</code></a> is installed, which is a special tool for managing image metadata.</p>
<p>You can use it to analyze more information about the image John posted:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> <span class="co"># First, ensure that exiv2 is installed</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> which exiv2</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/usr/bin/exiv2</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> <span class="co"># Then, download John&#39;s image</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> wget http://localhost:3000/assets/public/images/uploads/favorite-hiking-place.png</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[...output</span> ommitted...]</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> <span class="co"># Finally, get all of the Exif data from the image</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> exiv2 <span class="at">-g</span> GPS favorite-hiking-place.png</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Exif.Image.GPSTag</span>                            Long        1  50</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Exif.GPSInfo.GPSVersionID</span>                    Byte        4  2.2.0.0</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Exif.GPSInfo.GPSLatitudeRef</span>                  Ascii       2  North</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Exif.GPSInfo.GPSLatitude</span>                     Rational    3  36deg 58<span class="st">&#39; 0&quot;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="st">Exif.GPSInfo.GPSLongitudeRef                 Ascii       1  West</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="st">Exif.GPSInfo.GPSLongitude                    Rational    3  84deg 21&#39;</span> 0<span class="st">&quot;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="st">Exif.GPSInfo.GPSMapDatum                     Ascii       6  WGS-84</span></span></code></pre></div>
<p>You can also use <code>identify</code> from <a href="https://imagemagick.org/">ImageMagick</a>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> <span class="co"># ensure identify is installed</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> which identify</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/usr/bin/identify</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> identify <span class="at">-verbose</span> favorite-hiking-place.png <span class="kw">|</span> <span class="fu">grep</span> GPS</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">exif:GPSInfo:</span> 50</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">exif:GPSLatitude:</span> 36/1, 57523/1000, 0/1</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">exif:GPSLatitudeRef:</span> N</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">exif:GPSLongitude:</span> 84/1, 20893/1000, 0/1</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">exif:GPSLongitudeRef:</span> W</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="ex">exif:GPSMapDatum:</span> WGS-84</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="ex">exif:GPSVersionID:</span> ....</span></code></pre></div>
<p>Either way works, and it gives us the coordinates <code>36°58'0"N 84°21'0"W</code> (<a href="https://maps.app.goo.gl/rCqd4qk7W7sRomsMA">view on Google Maps</a>).</p>
<p>This is part of Daniel Boone National Forest. (Super beautiful place btw. I can totally recommend it.)</p>
<p>I got lucky that John had the same taste in capitalization as Google Maps, but I imagine there are quite a number of possible locations that one might want to enter.</p>
<p>Either way, this is a good reminder of how security questions rely on information that can be deduced or leaked, and are not very secure.</p>
<p>Also, it’s important to automatically strip exif location data from user images before hosting them publicly. Almost all social media websites do this automatically.</p>
<h2 id="poison-null-byte">Poison Null Byte</h2>
<blockquote>
<p>Bypass a security control with a <a href="https://www.martellosecurity.com/kb/mitre/cwe/626/#description">Poison Null Byte</a> to access a file not meant for your eyes. (Difficulty Level: 4)</p>
</blockquote>
<p>From the linked definition:</p>
<blockquote>
<p>A null byte (NUL character) can have different meanings across representations or languages. For example, it is a string terminator in standard C libraries, but Perl and PHP strings do not treat it as a terminator. When two representations are crossed - such as when Perl or PHP invokes underlying C functionality - this can produce an interaction error with unexpected results. Similar issues have been reported for ASP. Other interpreters written in C might also be affected.</p>
<p>The poison null byte is frequently useful in path traversal attacks by terminating hard-coded extensions that are added to a filename. It can play a role in regular expression processing in PHP.</p>
<p>— <cite><a href="https://www.martellosecurity.com/kb/mitre/cwe/626/#description">Null Byte Interaction Error (Poison Null Byte) - Martello Security</a></cite></p>
</blockquote>
<p>Because basically, when we go to a URL, we are requesting a resource with a certain name. Whether we can see that resource depends on if it ends in <code>.md</code> or <code>.pdf</code>. So, the null byte is a tool we can use to create a separation between the resource we’re requesting and what the string ends with, such that we can bypass checks for file extensions.</p>
<p>Here are two examples:</p>
<h2 id="forgotten-sales-backup">Forgotten Sales Backup</h2>
<blockquote>
<p>Access a salesman’s forgotten backup file. (Difficulty Level: 4)</p>
</blockquote>
<p>It’s great to keep backups! It’s not great for random people to be able to steal your backups.</p>
<p>This begins similarly to the Confidential Document challenge, shown <a href="#confidential-document">above</a>.</p>
<p>Let’s look back at our ftp server:</p>
<figure>
<img src="../assets/juice-shop/sensitive-data/image-20231003213243469.png" alt="The exact same as before." /><figcaption aria-hidden="true">The exact same as before.</figcaption>
</figure>
<p>In particular, we’re looking for a sales backup.</p>
<p>Out of all the files here, it looks like two could be backups:</p>
<ul>
<li><code>coupons_2013.md.bak</code></li>
<li><code>package.json.bak</code></li>
</ul>
<p>Of those, the <code>package.json.bak</code> doesn’t look like something related to a salesperson, so let’s take a look at <code>coupons_2013.md.bak</code>.</p>
<figure>
<img src="../assets/juice-shop/sensitive-data/image-20231004004552080.png" alt="403 Error: Only .md and .pdf files are allowed!" /><figcaption aria-hidden="true"><em>403</em> Error: Only .md and .pdf files are allowed!</figcaption>
</figure>
<p>Ah, it looks like we’re not allowed to view <code>.bak</code> files. So, we somehow need to convince the server that we’re accessing a <code>.md</code> or <code>.pdf</code> file, when we’re actually requesting the <code>.md.bak</code> file.</p>
<p>Using the technique from the Poison Null Byte challenge, we can start by identifying the resource we want to download. In this case, that’s <code>/ftp/coupons_2013.md.bak</code>.</p>
<p>Now, we append a file extension that is allowed, and join it with a null byte: <code>/ftp/coupons_2013.md.bak%00.pdf</code></p>
<p>Next, we <a href="https://developer.mozilla.org/en-US/docs/Glossary/Percent-encoding">URL encode</a> the percent sign: <code>/ftp/coupons_2013.md.bak%2500.pdf</code>.</p>
<p>Finally, we can download the file to get our flag:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> wget http://localhost:3000/ftp/coupons_2013.md.bak%2500.pdf <span class="at">-O</span> coupons_2013.md</span></code></pre></div>
<p>Note that you will have to go back to the Juice Shop index to see your flag for this challenge.</p>
<p>You should see the flag for the Poison Null Byte challenge as well.</p>
<h2 id="forgotten-developer-backup">Forgotten Developer Backup</h2>
<p>Using the exact same technique, we can simply do:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> wget http://localhost:3000/ftp/package.json.bak%2500.md <span class="at">-O</span> package.json.bak</span></code></pre></div>
<p>to complete this challenge.</p>
<h1 id="conclusion">Conclusion</h1>
<p>Congratulations! 🎉</p>
<p>I hope you learned something new today.</p>
<p>Come back next week for our foreign exchange meeting, where we’ll be learning more about other injection techniques.</p>
<p>As always, feel free to <a href="https://zack.fyi/contact.html">reach out to me</a> with feedback about this week’s lesson. Thanks! 😊</p>


    </article>
  </main>

<footer>
  <style>
    .edit {
      margin-bottom: 1em;
    }
    .page-bottom {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2em;
    }
  </style>

  <div class="page-bottom">
    <div class="copyright">
      &copy; 2023 Zack Sargent
    </div>
    <div class="top">
      <a href="javascript:window.scrollTo({ top: 0, behavior: 'smooth' })">
        Go to Top
      </a>
    </div>
  </div>

  
    <details>
      <summary>See edit history for "OWASP Juice Shop Sensitive Data Exposure Walkthrough"</summary>
      <dl class="edits">
        
          <div class="edit">
            <dt>
              Zack Sargent edited this page on 
              <time datetime="2023-10-04T11:05:09-04:00">
                Wednesday, October 04, 2023 at 11:05 AM
              </time>
            </dt>
            <dd>
              1 file changed, 15 insertions(+), 15 deletions(-)
            </dd>
          </div>
        
          <div class="edit">
            <dt>
              Zack Sargent edited this page on 
              <time datetime="2023-10-04T09:45:20-04:00">
                Wednesday, October 04, 2023 at 09:45 AM
              </time>
            </dt>
            <dd>
              1 file changed, 2 insertions(+), 1 deletion(-)
            </dd>
          </div>
        
          <div class="edit">
            <dt>
              Zack Sargent edited this page on 
              <time datetime="2023-10-04T01:58:01-04:00">
                Wednesday, October 04, 2023 at 01:58 AM
              </time>
            </dt>
            <dd>
              1 file changed, 365 insertions(+)
            </dd>
          </div>
        
      </dl>
    </details>
  
</footer>

  <script>
    anchors.add('h1:not(.post-title), h2, h3, h4, h5, h6');
  </script>
</body>

</html>
